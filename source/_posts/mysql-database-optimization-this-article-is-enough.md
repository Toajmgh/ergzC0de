title: MySQL数据库优化，看这篇就够了
author: ergz
tags:
  - Mysql
categories:
  - 数据库
date: 2018-10-18 23:00:00
---
## 前言
**数据库优化一方面是找出系统的瓶颈,提高MySQL数据库的整体性能,而另一方面需要合理的结构设计和参数调整,以提高用户的相应速度,同时还要尽可能的节约系统资源,以便让系统提供更大的负荷.**

### 1. 优化一览图

![upload successful](/images/mysql_201912182301.png)
<!--more-->
### 2. 优化
笔者将优化分为了两大类,软优化和硬优化,软优化一般是操作数据库即可,而硬优化则是操作服务器硬件及参数设置.
#### 2.1 软优化
##### 2.1.1 查询语句优化
1.首先我们可以用EXPLAIN或DESCRIBE(简写:DESC)命令分析一条查询语句的执行信息.
2.例:**DESC SELECT * FROM user**
显示：
![upload successful](/images/mysql_201912182306.png)
其中会显示索引和查询数据读取数据条数等信息.

##### 2.1.2 优化子查询
在MySQL中,尽量使用JOIN来代替子查询.因为子查询需要嵌套查询,嵌套查询时会建立一张临时表,临时表的建立和删除都会有较大的系统开销,而连接查询不会创建临时表,因此效率比嵌套子查询高.

##### 2.1.3 使用索引
索引是提高数据库查询速度最重要的方法之一,关于索引可以参高笔者<MySQL数据库索引>一文,介绍比较详细,此处记录使用索引的三大注意事项:
	1.LIKE关键字匹配'%'开头的字符串,不会使用索引.
	2.OR关键字的两个字段必须都是用了索引,该查询才会使用索引.
	3.使用多列索引必须满足最左匹配.
##### 2.1.4 分解表
对于字段较多的表,如果某些字段使用频率较低,此时应当,将其分离出来从而形成新的表,

##### 2.1.5 中间表
对于将大量连接查询的表可以创建中间表,从而减少在查询时造成的连接耗时.

##### 2.1.6 增加冗余字段
类似于创建中间表,增加冗余也是为了减少连接查询.

##### 2.1.7 分析表,检查表,优化表
分析表主要是分析表中关键字的分布,检查表主要是检查表中是否存在错误,优化表主要是消除删除或更新造成的表空间浪费.

一.分析表: 使用 **ANALYZE** 关键字,如**ANALYZE TABLE user;**
![upload successful](/images/mysql_201912182311.png)
1.Op:表示执行的操作.
2.Msg_type:信息类型,有status,info,note,warning,error.
3.Msg_text:显示信息.

二.检查表: 使用**CHECK**关键字,如**CHECK TABLE user [option]**
option只对MyISAM有效,共五个参数值:
1.QUICK:不扫描行,不检查错误的连接.
2.FAST:只检查没有正确关闭的表.
3.CHANGED:只检查上次检查后被更改的表和没被正确关闭的表.
4.MEDIUM:扫描行,以验证被删除的连接是有效的,也可以计算各行关键字校验和.
5.EXTENDED:最全面的的检查,对每行关键字全面查找.

三.优化表:使用**OPTIMIZE**关键字,如**OPTIMIZE [LOCAL|NO_WRITE_TO_BINLOG] TABLE user;**
LOCAL|NO_WRITE_TO_BINLOG都是表示不写入日志.,优化表只对VARCHAR,BLOB和TEXT有效,通过OPTIMIZE TABLE语句可以消除文件碎片,在执行过程中会加上只读锁.

#### 2.2 硬优化
##### 2.2.1 硬件三件套
1.配置多核心和频率高的cpu,多核心可以执行多个线程.
2.配置大内存,提高内存,即可提高缓存区容量,因此能减少磁盘I/O时间,从而提高响应速度.
3.配置高速磁盘或合理分布磁盘:高速磁盘提高I/O,分布磁盘能提高并行操作的能力.
##### 2.2.2 优化数据库参数
优化数据库参数可以提高资源利用率,从而提高MySQL服务器性能.MySQL服务的配置参数都在my.cnf或my.ini,下面列出性能影响较大的几个参数.

1.key_buffer_size:索引缓冲区大小
2.table_cache:能同时打开表的个数
3.query_cache_size和query_cache_type:前者是查询缓冲区大小,后者是前面参数的开关,0表示不使用缓冲区,1表示使用缓冲区,但可以在查询中使用4.SQL_NO_CACHE表示不要使用缓冲区,2表示在查询中明确指出使用缓冲区才用缓冲区,即SQL_CACHE.
5.sort_buffer_size:排序缓冲区

**传送门:[更多参数](https://www.mysql.com/cn/why-mysql/performance/index.html)**

##### 2.2.3 分库分表
因为数据库压力过大，首先一个问题就是高峰期系统性能可能会降低，因为数据库负载过高对性能会有影响。另外一个，压力过大把你的数据库给搞挂了怎么办？所以此时你必须得对系统做分库分表 + 读写分离，也就是把一个库拆分为多个库，部署在多个数据库服务上，这时作为主库承载写入请求。然后每个主库都挂载至少一个从库，由从库来承载读请求。
![upload successful](/images/mysql_201912182321.png)

##### 2.2.4 缓存集群
![upload successful](/images/mysql_201912182322.png)

## 结语
一个完整而复杂的高并发系统架构中，一定会包含各种复杂的自研基础架构系统和各种精妙的架构设计.因此一篇小文顶多具有抛砖引玉的效果,但是数据库优化的思想差不多就这些了.

**原文链接:[MySQL数据库优化](https://segmentfault.com/a/1190000018631870)
欢迎转载，请注明出处！**