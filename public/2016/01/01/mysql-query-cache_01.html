<!DOCTYPE html>
<html>
<head>
  
  <meta charset="utf-8">
  

  
  <title>关于mysql查询缓存详解 | ergzC0de</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="mysql查询缓存   在sql调优的过程中，发现原本很慢的一条sql（将近1分钟）在第二次运行时，瞬间就完成了（0.04sec）。 这是因为mysql自带的缓存机制，将查询结果进行缓存，如果table数据未发生变化，再次使用同一条sql进行查询时，直接从上次的查询结果缓存中读取数据，而不是重新分析、执行sql。 如果table数据发生变化，所有与之相关的缓存数据都会被释放刷新，这样就不会出现数据">
<meta name="keywords" content="Mysql">
<meta property="og:type" content="article">
<meta property="og:title" content="关于mysql查询缓存详解">
<meta property="og:url" content="http:&#x2F;&#x2F;www.ergzcode.com&#x2F;2016&#x2F;01&#x2F;01&#x2F;mysql-query-cache_01.html">
<meta property="og:site_name" content="ergzC0de">
<meta property="og:description" content="mysql查询缓存   在sql调优的过程中，发现原本很慢的一条sql（将近1分钟）在第二次运行时，瞬间就完成了（0.04sec）。 这是因为mysql自带的缓存机制，将查询结果进行缓存，如果table数据未发生变化，再次使用同一条sql进行查询时，直接从上次的查询结果缓存中读取数据，而不是重新分析、执行sql。 如果table数据发生变化，所有与之相关的缓存数据都会被释放刷新，这样就不会出现数据">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2020-01-03T17:11:23.656Z">
<meta name="twitter:card" content="summary">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">ergzC0de</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">代码也是一种艺术</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">首页</a>
        
          <a class="main-nav-link" href="/archives">归档</a>
        
          <a class="main-nav-link" href="/contact/me.html">Call我</a>
        
      </nav>
      <nav id="sub-nav">
        
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://www.ergzcode.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-mysql-query-cache_01" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/01/01/mysql-query-cache_01.html" class="article-date">
  <time datetime="2016-01-01T14:48:00.000Z" itemprop="datePublished">2016-01-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      关于mysql查询缓存详解
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>mysql查询缓存</strong>  </p>
<p>在sql调优的过程中，发现原本很慢的一条sql（将近1分钟）在第二次运行时，瞬间就完成了（0.04sec）。 这是因为mysql自带的缓存机制，将查询结果进行缓存，如果table数据未发生变化，再次使用同一条sql进行查询时，直接从上次的查询结果缓存中读取数据，而不是重新分析、执行sql。 如果table数据发生变化，所有与之相关的缓存数据都会被释放刷新，这样就不会出现数据脏读问题。</p>
<a id="more"></a>

<p>The query cache stores the text of a SELECT statement together with the corresponding result that was sent to the client. If an identical statement is received later, the server retrieves the results from the query cache rather than parsing and executing the statement again. The query cache is shared among sessions, so a result set generated by one client can be sent in response to the same query issued by another client.  </p>
<p><strong>是否使用查询缓存</strong> </p>
<p>为了避免缓存，可以在sql查询语句的字段前增加<strong>SQL_NO_CACHE</strong>关键字，如：  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> t_user;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> SQL_NO_CACHE * <span class="keyword">from</span> t_user;</span><br></pre></td></tr></table></figure>
<p>反之，你也可以使用<strong>SQL_CACHE</strong>关键字，强制mysql从缓存中读取数据，如：  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">SQL_CACHE</span> * <span class="keyword">from</span> t_user;</span><br></pre></td></tr></table></figure>
<p>mysql还提供了一种释放全部缓存的方法:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">reset</span> <span class="keyword">query</span> <span class="keyword">cache</span>;</span><br></pre></td></tr></table></figure>
<p><strong>设置查询缓存</strong>  </p>
<p>查看是否有查询缓存：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">VARIABLES</span> <span class="keyword">LIKE</span> <span class="string">'have_query_cache'</span>;</span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>，只要数据库拥有查询缓存功能，这个VALUE就是YES，无论查询缓存是否启用，mysql默认为启用状态。mysql查询缓存可以通过两个变量来控制：<strong>query_cache_type</strong>和<strong>query_cache_size</strong>。  </p>
<p><strong>querycachetype</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">VARIABLES</span> <span class="keyword">LIKE</span> <span class="string">'query_cache_type'</span>;</span><br></pre></td></tr></table></figure>
<p><strong>query_cache_type</strong>包含三种状态：</p>
<ul>
<li>0 or OFF 此时不会从缓存中读取查询数据。</li>
<li>1 or ON 表示除非声明了SELECT SQL_NO_CACHE，否则都会从缓存中读取数据。</li>
<li>2 or DEMAND 表示所有语句都会从缓存中读取，相当于所有查询语句都使用了SELECT SQL_CACHE。</li>
</ul>
<p>通过如下命令可以设置查询缓存状态(需要管理员权限)，执行后，需要重启mysql服务才能生效。  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> query_cache_type = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p>但是此命令会影响所有的使用此mysql服务的client。可以通过如下命令，关闭此客户端的查询缓存状态，但是同样需要重启server后才能生效。  </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">SESSION</span> query_cache_type = <span class="keyword">OFF</span>;  </span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">VARIABLES</span> <span class="keyword">LIKE</span> <span class="string">'query_cache_type'</span>;</span><br></pre></td></tr></table></figure>
<p><strong>querycachesize</strong> </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">VARIABLES</span> <span class="keyword">LIKE</span> <span class="string">'query_cache_size'</span>;</span><br></pre></td></tr></table></figure>
<p><strong>querycachesize</strong>表示缓存大小，默认为1M。如果设置为0，则相当于:<strong>query_cache_type=OFF</strong>，同样可通过<strong>SET GLOBAL</strong>进行设置。 </p>
<pre><code class="sql"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> query_cache_size=<span class="number">40000</span>;  </code></pre>
<p>需要注意的是，设置的<strong>querycachesize</strong>，并不全是用于存储数据，还有约40KB的空间来维护查询缓存的结构。</p>
<p><strong>本文链接：<a href="">关于mysql查询缓存详解</a><br>欢迎转载，请注明出处！</strong></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.ergzcode.com/2016/01/01/mysql-query-cache_01.html" data-id="ck4yed9dw00008dd29j3gfvim" class="article-share-link">Share</a>
      
      
        <a href="/2016/01/01/mysql-query-cache_01.html#comments" class="article-comment-link">
          <span class="post-comments-count valine-comment-count" data-xid="/2016/01/01/mysql-query-cache_01.html" itemprop="commentCount"></span>
      留言
        </a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Mysql/" rel="tag">Mysql</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/01/04/read-lifes_01.html" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          阅读生活之人生赢家
        
      </div>
    </a>
  
  
    <a href="/2015/05/26/jackson-hibernateLazyInitializer_01.html" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Hibernate查询Jackson序列化懒加载问题</div>
    </a>
  
</nav>

  
</article>



  <section id="comments" class="vcomment">
  </section>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Java%E5%9F%BA%E7%A1%80/">Java基础</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Json/">Json</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/shell/">shell</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/web%E6%9C%8D%E5%8A%A1%E5%99%A8/">web服务器</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B7%A5%E5%85%B7/">工具</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%90%9E%E5%AE%9AJava%E9%9D%A2%E8%AF%95%E9%A2%98/">搞定Java面试题</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%94%9F%E6%B4%BB%E8%81%8C%E5%9C%BA/">生活职场</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/API/" style="font-size: 10px;">API</a> <a href="/tags/DesignPattern/" style="font-size: 10px;">DesignPattern</a> <a href="/tags/IDEA/" style="font-size: 12.5px;">IDEA</a> <a href="/tags/Java/" style="font-size: 20px;">Java</a> <a href="/tags/Jsp/" style="font-size: 10px;">Jsp</a> <a href="/tags/Mysql/" style="font-size: 12.5px;">Mysql</a> <a href="/tags/Nginx/" style="font-size: 12.5px;">Nginx</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/jackson/" style="font-size: 10px;">jackson</a> <a href="/tags/markdown/" style="font-size: 10px;">markdown</a> <a href="/tags/pm2/" style="font-size: 12.5px;">pm2</a> <a href="/tags/sql/" style="font-size: 10px;">sql</a> <a href="/tags/tomcat/" style="font-size: 10px;">tomcat</a> <a href="/tags/%E7%94%9F%E6%B4%BB/" style="font-size: 10px;">生活</a> <a href="/tags/%E9%9D%A2%E8%AF%95%E9%A2%98/" style="font-size: 17.5px;">面试题</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">2019年 12月</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">2019年 11月</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">2019年 06月</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">2019年 01月</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">2018年 10月</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">2016年 05月</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">2016年 01月</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">2015年 05月</a><span class="archive-list-count">5</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/12/25/idea-latest-active.html">最新IDEA永久激活</a>
          </li>
        
          <li>
            <a href="/2019/12/14/resources-collection-top.html">资源整理[置顶]</a>
          </li>
        
          <li>
            <a href="/2019/12/14/nginx-reverse-proxy-implements-the-mapping-of-secondary-domain-names-to-ports.html">Nginx反向代理实现二级域名与端口的映射</a>
          </li>
        
          <li>
            <a href="/2019/12/11/some-common-and-free-apis-for-developing.html">开发中常用的一些免费API</a>
          </li>
        
          <li>
            <a href="/2019/12/10/pm2-common-commands-introduction.html">PM2介绍</a>
          </li>
        
          <li>
            <a href="/2019/12/08/pm2-watch-hexo-process.html">PM2守护hexo的进程</a>
          </li>
        
          <li>
            <a href="/2019/11/26/git-orders_02.html">Git常用命令使用</a>
          </li>
        
          <li>
            <a href="/2019/11/26/git-orders_01.html">工作中99%能用到的Git命令</a>
          </li>
        
          <li>
            <a href="/2019/11/25/git-cheat-sheet.html">GIT命令清单</a>
          </li>
        
          <li>
            <a href="/2019/11/14/nginx-build-http-file-system.html">Nginx搭建HTTP文件服务器</a>
          </li>
        
      </ul>
    </div>
  </div>


  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
          Hosted by BCC<br/>
          Copyright 2020 www.ergzcode.com All Rights Reserved <br>
          苏ICP备19067763号-1
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
    <a href="/contact/me.html" class="mobile-nav-link">Call我</a>
  
</nav>

    

<script src="//cdn.jsdelivr.net/gh/jquery/jquery@3/dist/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine@1.3.10/dist/Valine.min.js"></script>
<script>
    var GUEST_INFO = ['nick','mail','link'];
    var guest_info = 'nick,mail,link'.split(',').filter(function(item){
        return GUEST_INFO.indexOf(item) > -1
    });
    var notify = 'false' == true;
    var verify = 'true' == true;
    new Valine({
        el: '.vcomment',
        notify: notify,
        verify: verify,
        appId: "teNimxGC1bQqqmwTFIUtEsi1-gzGzoHsz",
        appKey: "bjpKKR1Pq36WNhwSImLKdVNd",
        placeholder: "Please leave your footprints",
        pageSize:'10',
        avatar:'',
        lang:'zh-cn'
    });
</script>
 

  </div>
</body>
</html>